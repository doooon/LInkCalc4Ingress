<!DOCTYPE html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<meta name="robots" content="noindex,nofollow">
<meta name="description" content="Link Calculator for Ingress (ver.1.2.2c)">
<meta name="author" content="doooon">
<link rel="apple-touch-icon" href="apple-touch-icon-precomposed.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<!--link rel="apple-touch-icon" href="apple-touch-icon.png"-->
<title>Link Calc</title>

<script type="text/javascript"
	src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyDRaTZlZNQ91E4lKF_75VVsTyH0zjnm0fs">
</script>

<script type="text/javascript" charset="utf-8">

	function AddEventListener(elementID, type, listener) {
		var element = document.getElementById(elementID);
	    if( element.addEventListener ) {
	        element.addEventListener( type, listener, false );
	    }
	    else if( element.attachEvent ) {
	        element.attachEvent( 'on' + type,
	            function() { listener.apply( element, arguments ); } );
	    }
	    else {
	        // not support.
	    }
	}

	function ArraySortNumeric(prev,next){
		return next - prev;
	}
	
	function resonatorClick(e) {
		var elem = e.target;
		if (elem.textContent == 1) { elem.textContent = 8; elem.className = "cResoSlot R8"; }
		else { elem.textContent --; elem.className = "cResoSlot R" + elem.textContent; }
		funcResult();
	}
	
	function resonatorPress(elemID) {
		var elem = document.getElementById(elemID);
		flag_press = 0;
		elem.textContent = 8; 
		elem.className = "cResoSlot R8";
		funcResult();
	}
	
	function modSlotClick(e) {
		var elem = e.target;
		if (elem.textContent.match(/^\s*$/i)) 	{ elem.textContent = "LA"; 		elem.className = "cModSlot LA"; 	}
		else if (elem.textContent == "LA") 		{ elem.textContent = "SBUL"; 	elem.className = "cModSlot SBUL"; 	}
		else if (elem.textContent == "SBUL") 	{ elem.textContent = "VRLA"; 	elem.className = "cModSlot VRLA"; 	}
		else if (elem.textContent == "VRLA") 	{ elem.textContent = " "; 		elem.className = "cModSlot none"; 	}
		funcResult();
	}
	
	function allReset() {
		flag_press = 0;
		for (var i=0; i<8; i++ ) {
			document.getElementById('Resonator0' + i).textContent = '8'; 
			document.getElementById('Resonator0' + i).className = "cResoSlot R8";
		}
		for (var i=0; i<4; i++ ) {
			document.getElementById('ModSlot0' + i).textContent = ''; 
			document.getElementById('ModSlot0' + i).className = "cModSlot none";
		}
		funcResult();
	}

	function touchHandler(e) {
		e.preventDefault();
		switch (e.type) {
			case "touchstart" :
				flag_press = 1;
				timerID = setTimeout(function(){resonatorPress(e.target.id)}, 400);
				break;
			case "touchcancel" :
				clearTimeout(timerID);
				flag_press = 0;
				break;
			case "touchend" :
				clearTimeout(timerID);
				if (flag_press == 1) { resonatorClick(e) }
				flag_press = 0;
				break;
		}
	}

	function mouseHandler(e) {
		e.preventDefault();
		switch (e.type) {
			case "mousedown" :
				flag_press = 1;
				timerID = setTimeout(function(){resonatorPress(e.target.id)}, 400);
				break;
			case "mouseup" :
				clearTimeout(timerID);
				if (flag_press == 1) { resonatorClick(e) }
				flag_press = 0;
				break;
		}
	}

	function FuncLoad() {
		getCookie();
		
		if(window.TouchEvent){
			for (var i=0; i<8; i++) {
				AddEventListener('Resonator0' + i, "touchstart", touchHandler);
				AddEventListener('Resonator0' + i, "touchend", touchHandler);
				AddEventListener('Resonator0' + i, "touchcancel", touchHandler);
			}
			for (var i=0; i<4; i++) {
				AddEventListener('ModSlot0' + i, "touchend", modSlotClick);
			}
			AddEventListener('reset', "touchend", allReset);
			AddEventListener('map-open-button-div', "touchend", mapOpen);	
		}else{
			for (var i=0; i<8; i++) {
				AddEventListener('Resonator0' + i, "mousedown", mouseHandler);
				AddEventListener('Resonator0' + i, "mouseup", mouseHandler);
			}
			for (var i=0; i<4; i++) {
				AddEventListener('ModSlot0' + i, "click", modSlotClick);
			}
			AddEventListener('reset', "click", allReset);
			AddEventListener('map-open-button-div', "mouseup", mapOpen);	
		}
		AddEventListener('calc', "transitionend", calcTransitionFinish);
		funcResult();
	}
	
	function setSlotCookie() {
		var rList = new Array(8);
		for (var i=0; i<8; i++) {
			rList[i] = document.getElementById('Resonator0' + i).textContent;
		}
		var mList = new Array(4);
		for (i=0; i<4; i++) {
			mList[i] = document.getElementById('ModSlot0' + i).textContent;
		}			
		var exp = new Date();
		exp.setTime(exp.getTime()+1000*60*60*24*1);
		var str = rList.join(',') + '+' + mList.join(',');
		var escstr = encodeURIComponent(str);
		document.cookie = "LinkCalc4Ingress=" + escstr + "; expires=" + exp.toGMTString();
	}
	
	function setLocationCookie(lat, lng) {
		if (map) {
			var exp = new Date();
			exp.setTime(exp.getTime()+1000*60*60*24*365);
			var str = lat + "," + lng;
			var escstr = encodeURIComponent(str);
			document.cookie = "LinkCalc4IngressLocation=" + escstr + "; expires=" + exp.toGMTString();
		}
	}
	
	function getCookie() {
	    var cookieList = new Array();
	    var allcookies = document.cookie;
	    if( allcookies != '' ) {
	        var cookies = allcookies.split( '; ' );
	        for( var i = 0; i < cookies.length; i++ ) {
	            var cookie = cookies[ i ].split( '=' );
	            cookieList[cookie[0]] = decodeURIComponent(cookie[1]);
	        }
			if (cookieList['LinkCalc4IngressLocation']) {
				cookieLatLng['lat'] = Number(cookieList['LinkCalc4IngressLocation'].split(',')[0]);
				cookieLatLng['lng'] = Number(cookieList['LinkCalc4IngressLocation'].split(',')[1]);
				cookieLatLng['function'] = "getCookie()";
			}
			if (cookieList['LinkCalc4Ingress']) {
				var rList = new Array(8);
				rList = cookieList['LinkCalc4Ingress'].split('+')[0].split(',');
				var mList = new Array(4);
				mList = cookieList['LinkCalc4Ingress'].split('+')[1].split(',');
				for (var i in rList) {
					var elem = document.getElementById("Resonator0" + i );
					elem.textContent = rList[i];
					elem.className = "cResoSlot R" + elem.textContent;
				}
				for (i in mList) {
					var elem = document.getElementById("ModSlot0" + i );
					elem.textContent = mList[i];
					if (elem.textContent.match(/^\s*$/i)) 	{ elem.className = "cModSlot none"; }
					else if (elem.textContent == "LA") 		{ elem.className = "cModSlot LA"; 	}
					else if (elem.textContent == "VRLA") 	{ elem.className = "cModSlot VRLA"; }
					else if (elem.textContent == "SBUL") 	{ elem.className = "cModSlot SBUL"; }
				}
			}
    	}
	}
			
	function mapOpen() {
		setTimeout(function(){document.getElementById('calc').style.top = "100%"}, 400);
	}
	
	function mapClose() {
		document.getElementById('calc').style.top = "0%";
		document.getElementById('calc').style.height = "100%";
	}
	
	function calcTransitionFinish(){
		if (document.getElementById('calc').style.top == "100%") {
			document.getElementById('calc').style.height = "0%";
		}
	}

	function funcResult() {
		var outLink = 8;
		
		var resoList = new Array(8);
		resoList[0] = Number(document.getElementById("Resonator00").textContent);
		resoList[1] = Number(document.getElementById("Resonator01").textContent);
		resoList[2] = Number(document.getElementById("Resonator02").textContent);
		resoList[3] = Number(document.getElementById("Resonator03").textContent);
		resoList[4] = Number(document.getElementById("Resonator04").textContent);
		resoList[5] = Number(document.getElementById("Resonator05").textContent);
		resoList[6] = Number(document.getElementById("Resonator06").textContent);
		resoList[7] = Number(document.getElementById("Resonator07").textContent);
		
		var modList = new Array(4);
		modList[0] = document.getElementById("ModSlot00").textContent;
		modList[1] = document.getElementById("ModSlot01").textContent;
		modList[2] = document.getElementById("ModSlot02").textContent;
		modList[3] = document.getElementById("ModSlot03").textContent;
		
		var modNList = new Array(4);

		var averageLevel = eval(resoList.join("+"))/8;
		var rawLinkRange_km = 160 * (averageLevel * averageLevel * averageLevel * averageLevel) / 1000;
		
		for (var i in modList) {
			if (modList[i].match(/^VRLA$/i)) { 	// very rare LinkAmp
				modNList[i] = 7;
			} else if (modList[i].match(/^SBUL$/i)) { // softbank Ultra Link
				modNList[i] = 5;
				outLink += 8;
			} else if (modList[i].match(/^LA$/i)) { // rare LinkAmp
				modNList[i] = 2;
			}
		}
		
		// ソート
		modNList.sort(ArraySortNumeric);
		
		var rate = 0;
		for (var i in modNList) {
			if (i == 0) { rate += (modNList[i]*1.00) }
			else if (i == 1) { rate += (modNList[i]*0.25) }
			else if (i == 2) { rate += (modNList[i]*0.125) }
			else if (i == 3) { rate += (modNList[i]*0.125) }
		}
		if (rate == 0) { rate = 1 }
		
		// Potal Level
		document.getElementById('potalLevel').textContent = "LINK RANGE " + "(P" + Math.floor(averageLevel) + ")";
		
		// result
		amplifiedLinkRange_km = rawLinkRange_km * rate;
		document.getElementById('result').innerHTML = amplifiedLinkRange_km.toFixed(3) + ' km' 
		
		// discription
		document.getElementById('discription').innerHTML = rawLinkRange_km.toFixed(3) + ' km' + ' ×' + rate.toFixed(2) + '<br>\n';
		document.getElementById('discription').innerHTML = document.getElementById('discription').innerHTML + 'Max Outbound Links = ' + outLink;
		
		// cookie set
		setSlotCookie();
		
		// googleMap circle range change
		//if (circle) {circle.setRadius(amplifiedLinkRange_km*1000)}
		
		// googleMap zoom change
		//if (map) {map.setZoom(getZoomLevel(amplifiedLinkRange_km*1000))}
	}
			
</script>

<script type="text/javascript" charset="utf-8">
	var flag_press = 0;
	var timerID = '';
	var amplifiedLinkRange_km = 0;
	var cookieLatLng = {};

	// window scroll cancel
	document.addEventListener("touchmove", function(elem) { if(window.innerHeight >= document.body.scrollHeight){elem.preventDefault()} }, false);
	
	document.addEventListener("DOMContentLoaded", FuncLoad, false);
				
	// maps load
	setTimeout(function(){	
		var script2 = document.createElement("script");
		script2.type = "text/javascript";
		script2.src = "./map.js";
		document.body.appendChild(script2);
	}, 0);
	
</script>

	<style type="text/css">
	<!--
	* {
		user-select: none; 				/* CSS3 */
		-moz-user-select: none; 		/* Firefox */
		-webkit-user-select: none; 		/* Safari、Chrome */
		-ms-user-select: none; 			/* IE10 */	
	}
	html, body, #calc {
	    margin: 0;
	    padding: 0;
	    height: 100%;
	    width: 100%;
		padding: 0px;
	    overflow: hidden;
	}

	#map-canvas { 
		border: 0px red dotted; 
		height: 100%; 
		margin: 0; 
		padding: 0;
	}
	
	#calc {
		position: absolute; top: 0px; left: 0px;
		background-color: white;
		/* background-color: rgba(255,255,255,0.6); */
		/* opacity:0.5;	debug */
		transition-property: top;
		transition-duration: 0.5s;
		transition-timing-function: ease;
		transition-delay: 0s;
		-moz-transition: 	top 0.5s ease 0s;
		-webkit-transition: top 0.5s ease 0s;
		-o-transition: 		top 0.5s ease 0s;
		-ms-transition: 	top 0.5s ease 0s;
		
		text-align: center;
	}
		
	/*
	*/
	
	#result { 
		font-size: xx-large;
		font-family: sans-serif;
		width: 80%;
		margin: 0px auto;
		padding: 0px;
		
		border: 1px solid #999;
		border-radius: 8px;	
		box-shadow: 2px 2px 5px 0px rgba(0,0,0,0.2) inset;
		
		user-select: text; 				/* CSS3 */
		-moz-user-select: text; 		/* Firefox */
		-webkit-user-select: text; 		/* Safari、Chrome */
		-ms-user-select: text; 			/* IE10 */	
	}
	
	.cMap-open-button-div-parentbox {
		display:table;
		margin: 7px auto 0px auto;

		font-family: sans-serif;
		font-weight: bold;
		font-size: x-large;
		text-align: center;
	}
	#map-open-button-div, #map-close-button-div, #map-marker-button-div {
		height: 1.2em;
		border: 2px solid #fff;
		border-radius: 8px;	
		box-shadow: 2px 2px 5px 0px rgba(0,0,0,0.2);

		margin: 0px;
		padding: 2px 0px 0px 0px;
				
		background-color: #ff6600;
		color: white;
		
		font-family: sans-serif;
		font-weight: bold;
		font-size: x-large;
		text-align: center;
				
		display: table-cell;
		vertical-align: middle;

		cursor: pointer;
	}
	#map-open-button-div { width: 5em; }
	#map-close-button-div { width: 5em; position: relative; bottom: 40px; }
	#map-marker-button-div { width: 1.2em; position: relative; top: 40px; }
	#map-current-location-button-div { 
		width: 1.2em; 
		height: 1em; 
		padding: 0px; 
		margin: 0px; 
		
		position: relative; 
		bottom: 10px; 
		right: 10px; 
		
		border: 1px solid #999;
		border-radius: 4px;	
		box-shadow: 1px 1px 2px 0px rgba(0,0,0,0.2);
		background-color: #fff; 
		
		color: #666;
		font-family: sans-serif;
		font-weight: bold;
		font-size: x-large;
		text-align: center;
		
		display: table-cell;
		vertical-align: middle;
		
		cursor: pointer;
	}

	#discription { 
		font-size: medium; 
		font-family: sans-serif;
		line-height: 1.2em;
		height: 2em;
		width: 80%;
		margin: 5px auto 0px auto;
		padding: 0px;
		
		user-select: text; 				/* CSS3 */
		-moz-user-select: text; 		/* Firefox */
		-webkit-user-select: text; 		/* Safari、Chrome */
		-ms-user-select: text; 			/* IE10 */	
	}
	.cSlotDIV {
		display:table;
		margin: 0px auto;
	}
	.cDIVmargin {	
		margin: 10px;
	}
	.cResoSlot 	{ 
		font-size: xx-large; 
		border: 1px black solid; 
		width: 50px;
		height: 50px;
		margin: 10px;
		display: table-cell;
		vertical-align: middle;
		border-radius: 8px;	
		font-family: sans-serif;
		box-shadow: 2px 2px 5px 0px rgba(0,0,0,0.2) inset;
		cursor: pointer;
	}
	.cModSlot 	{ 
		font-size: large; 
		border: 1px black solid; 
		width: 50px;
		height: 50px;
		margin: 10px;
		display: table-cell;
		vertical-align: middle;
		border-radius: 8px;	
		font-family: sans-serif;
		box-shadow: 2px 2px 5px 0px rgba(0,0,0,0.2) inset;
		cursor: pointer;
	}
	.title {
		margin: 10px 0px 3px 0px;
	}
		
	.LA 		{ background-color: #9d8af3; color: #ffffff; }
	.SBUL 		{ background-color: #FFCC33; }
	.VRLA 		{ background-color: #ff8af7; }
	.none 		{ background-color: #ffffff; }
	.R1 		{ background-color: #FFE600; }
	.R2 		{ background-color: #FFAB00; }
	.R3 		{ background-color: #FF6200; color: #ffffff; }
	.R4 		{ background-color: #F00000; color: #ffffff; }
	.R5 		{ background-color: #F00090; color: #ffffff; }
	.R6 		{ background-color: #CB3DC4; color: #ffffff; }
	.R7 		{ background-color: #892A9A; color: #ffffff; }
	.R8 		{ background-color: #5E2ABA; color: #ffffff; }
	
	#reset		{ 
		margin: 15px 0px 15px 0px; 
		font-size: large; 
		
		/*iPhoneでテキストルーペが出てしまうため*/
		user-select: none; 			/* CSS3 */
		-moz-user-select: none; 	/* Firefox */
		-webkit-user-select: none; 	/* Safari、Chrome */
		-ms-user-select: none; 		/* IE10 */	
	}
	.hint 		{ font-size: small; margin: 0px 0px 0px 0px; }
	.developer 	{ font-size: x-small; margin: 3px 0px 0px 0px; }
		
	-->
	</style>
	
</head>
<body id="body-div">
<div id="map-canvas"></div>
<div id="calc">
	<div class="title" id="potalLevel">
		LINK RANGE
	</div>
		<div id="result">result result result result</div>
		<div id="discription">discription discription discription</div>
	<div class="cMap-open-button-div-parentbox">
		<div id="map-open-button-div">MAP</div>
	</div>
	<div class="title">
		RESONATORS
	</div>
	<div class="cSlotDIV">
		<div class="cResoSlot R8" id="Resonator00">8</div>
		<div class="cDIVmargin"></div>
		<div class="cResoSlot R8" id="Resonator01">8</div>
		<div class="cDIVmargin"></div>
		<div class="cResoSlot R8" id="Resonator02">8</div>
		<div class="cDIVmargin"></div>
		<div class="cResoSlot R8" id="Resonator03">8</div>
	</div>
	<div class="cDIVmargin"></div>
	<div class="cSlotDIV">
		<div class="cResoSlot R8" id="Resonator04">8</div>
		<div class="cDIVmargin"></div>
		<div class="cResoSlot R8" id="Resonator05">8</div>
		<div class="cDIVmargin"></div>
		<div class="cResoSlot R8" id="Resonator06">8</div>
		<div class="cDIVmargin"></div>
		<div class="cResoSlot R8" id="Resonator07">8</div>
	</div>
	<div class="title">
		MOD SLOTS
	</div>
	<div class="cSlotDIV">
		<div class="cModSlot" id="ModSlot00"> </div>
		<div class="cDIVmargin"></div>
		<div class="cModSlot" id="ModSlot01"> </div>
		<div class="cDIVmargin"></div>
		<div class="cModSlot" id="ModSlot02"> </div>
		<div class="cDIVmargin"></div>
		<div class="cModSlot" id="ModSlot03"> </div>
	</div>
	<div><input type="button" value="reset" name="reset" id="reset"></div>
	<div class="hint">Long press resonator-slot to default (R8).</div>
	<div class="developer">DEVELOPED BY DOOOON.</div>
</div>
</body>
